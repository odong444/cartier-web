<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë¥´í‹°ì— ì¬ê³  í™•ì¸</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { margin-bottom: 30px; color: #333; }
        .section { margin-bottom: 30px; }
        .section-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #555; }
        
        /* URL ì…ë ¥ */
        .url-input { display: flex; gap: 10px; margin-bottom: 20px; }
        .url-input input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        
        /* ë²„íŠ¼ */
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 500; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        
        /* URL ëª©ë¡ */
        .url-list { border: 1px solid #ddd; border-radius: 5px; max-height: 300px; overflow-y: auto; }
        .url-item { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .url-item:last-child { border-bottom: none; }
        .url-info { flex: 1; }
        .url-title { font-weight: bold; margin-bottom: 5px; }
        .url-memo { color: #666; font-size: 12px; margin-bottom: 3px; }
        .url-link { color: #007bff; font-size: 12px; word-break: break-all; }
        .url-status { padding: 5px 10px; border-radius: 3px; font-size: 12px; margin-left: 10px; }
        .status-available { background: #d4edda; color: #155724; }
        .status-unavailable { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; }
        
        /* ì»¨íŠ¸ë¡¤ */
        .controls { display: flex; gap: 10px; margin-bottom: 20px; }
        .status-info { background: #e7f3ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .status-info p { margin-bottom: 5px; }
        
        /* ë¡œê·¸ */
        .logs { background: #f8f9fa; border: 1px solid #ddd; border-radius: 5px; padding: 15px; height: 300px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 13px; }
        .log-entry { margin-bottom: 5px; }
        
        .empty-state { text-align: center; padding: 40px; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ ì¹´ë¥´í‹°ì— ì¬ê³  í™•ì¸</h1>
        
        <!-- ìƒíƒœ ì •ë³´ -->
        <div class="status-info">
            <p><strong>ëª¨ë‹ˆí„°ë§ ìƒíƒœ:</strong> <span id="monitoring-status">ì¤‘ì§€ë¨</span></p>
            <p><strong>í™•ì¸ íšŸìˆ˜:</strong> <span id="check-count">0</span>íšŒ</p>
            <p><strong>ë“±ë¡ëœ ì œí’ˆ:</strong> <span id="url-count">0</span>ê°œ</p>
        </div>
        
        <!-- URL ì¶”ê°€ -->
        <div class="section">
            <div class="section-title">ì œí’ˆ ì¶”ê°€</div>
            <div class="url-input">
                <input type="text" id="url-input" placeholder="ì¹´ë¥´í‹°ì— ì œí’ˆ URL ì…ë ¥">
                <input type="text" id="memo-input" placeholder="ë©”ëª¨ (ì„ íƒ)" style="max-width: 150px;">
                <button class="btn-primary" onclick="addUrl()">ì¶”ê°€</button>
            </div>
        </div>
        
        <!-- URL ëª©ë¡ -->
        <div class="section">
            <div class="section-title">ì œí’ˆ ëª©ë¡</div>
            <div class="url-list" id="url-list">
                <div class="empty-state">ë“±ë¡ëœ ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
        </div>
        
        <!-- ì»¨íŠ¸ë¡¤ -->
        <div class="controls">
            <button class="btn-success" id="monitor-btn" onclick="toggleMonitoring()">ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
            <button class="btn-primary" onclick="testTelegram()">í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸</button>
            <button class="btn-danger" onclick="clearLogs()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>
        
        <!-- ë¡œê·¸ -->
        <div class="section">
            <div class="section-title">ë¡œê·¸</div>
            <div class="logs" id="logs"></div>
        </div>
    </div>

    <script>
        let monitoringActive = false;
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                document.getElementById('monitoring-status').textContent = data.monitoring ? 'ì‹¤í–‰ ì¤‘ ğŸŸ¢' : 'ì¤‘ì§€ë¨ âšª';
                document.getElementById('check-count').textContent = data.check_count;
                document.getElementById('url-count').textContent = data.url_count;
                monitoringActive = data.monitoring;
                
                const btn = document.getElementById('monitor-btn');
                btn.textContent = data.monitoring ? 'ëª¨ë‹ˆí„°ë§ ì¤‘ì§€' : 'ëª¨ë‹ˆí„°ë§ ì‹œì‘';
                btn.className = data.monitoring ? 'btn-danger' : 'btn-success';
            } catch (e) {
                console.error('ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', e);
            }
        }
        
        // URL ëª©ë¡ ë¡œë“œ
        async function loadUrls() {
            try {
                const response = await fetch('/api/urls');
                const urls = await response.json();
                
                const listEl = document.getElementById('url-list');
                
                if (urls.length === 0) {
                    listEl.innerHTML = '<div class="empty-state">ë“±ë¡ëœ ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                
                listEl.innerHTML = urls.map((item, index) => `
                    <div class="url-item">
                        <div class="url-info">
                            <div class="url-title">${item.title || 'ì œí’ˆëª… ì—†ìŒ'}</div>
                            ${item.memo ? `<div class="url-memo">ğŸ“ ${item.memo}</div>` : ''}
                            <div class="url-link">${item.url}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="url-status ${getStatusClass(item.status)}">${item.status}</span>
                            <button class="btn-danger" onclick="deleteUrl(${index})">ì‚­ì œ</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('URL ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }
        
        function getStatusClass(status) {
            if (status === 'ì¬ê³  ìˆìŒ') return 'status-available';
            if (status === 'ì¬ê³  ì—†ìŒ') return 'status-unavailable';
            return 'status-pending';
        }
        
        // URL ì¶”ê°€
        async function addUrl() {
            const url = document.getElementById('url-input').value.trim();
            const memo = document.getElementById('memo-input').value.trim();
            
            if (!url) {
                alert('URLì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            try {
                const response = await fetch('/api/urls', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({url, memo})
                });
                
                if (response.ok) {
                    document.getElementById('url-input').value = '';
                    document.getElementById('memo-input').value = '';
                    loadUrls();
                    updateStatus();
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (e) {
                alert('ì¶”ê°€ ì‹¤íŒ¨: ' + e.message);
            }
        }
        
        // URL ì‚­ì œ
        async function deleteUrl(index) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await fetch(`/api/urls/${index}`, {method: 'DELETE'});
                loadUrls();
                updateStatus();
            } catch (e) {
                alert('ì‚­ì œ ì‹¤íŒ¨');
            }
        }
        
        // ëª¨ë‹ˆí„°ë§ í† ê¸€
        async function toggleMonitoring() {
            try {
                const action = monitoringActive ? 'stop' : 'start';
                const response = await fetch('/api/monitoring', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action})
                });
                
                if (response.ok) {
                    updateStatus();
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (e) {
                alert('ì‹¤íŒ¨: ' + e.message);
            }
        }
        
        // í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸
        async function testTelegram() {
            try {
                const response = await fetch('/api/test-telegram', {method: 'POST'});
                if (response.ok) {
                    alert('í…”ë ˆê·¸ë¨ ì „ì†¡ ì„±ê³µ!');
                } else {
                    alert('ì „ì†¡ ì‹¤íŒ¨');
                }
            } catch (e) {
                alert('ì˜¤ë¥˜: ' + e.message);
            }
        }
        
        // ë¡œê·¸ ë¡œë“œ
        async function loadLogs() {
            try {
                const response = await fetch('/api/logs');
                const logs = await response.json();
                
                const logsEl = document.getElementById('logs');
                logsEl.innerHTML = logs.map(log => `<div class="log-entry">${log}</div>`).join('');
                logsEl.scrollTop = logsEl.scrollHeight;
            } catch (e) {
                console.error('ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }
        
        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }
        
        // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
        setInterval(() => {
            updateStatus();
            loadUrls();
            loadLogs();
        }, 2000);
        
        // ì´ˆê¸° ë¡œë“œ
        updateStatus();
        loadUrls();
        loadLogs();
    </script>
</body>
</html>
